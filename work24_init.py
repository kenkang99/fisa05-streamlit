
'''
import streamlit as st
import pandas as pd
import numpy as np
import plotly.express as px
import warnings

warnings.filterwarnings('ignore')

# --- 1. ìƒ˜í”Œ ë°ì´í„° ìƒì„± (ê¸°ì¡´ ì½”ë“œë¥¼ ë°”ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡) ---
# ì‹¤ì œ ë°ì´í„°í”„ë ˆì„ 'df1_unique'ê°€ ìˆë‹¤ë©´ ì´ ë¶€ë¶„ì€ ì‚­ì œí•˜ê³  ì‹¤ì œ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.
# data = {
#     '3ì°¨ë¶„ë¥˜': ['ì›¹ê°œë°œ', 'ì›¹ê°œë°œ', 'ë°ì´í„°ë¶„ì„', 'ë°ì´í„°ë¶„ì„', 'UI/UX', 'UI/UX', 'ì„œë²„ê´€ë¦¬', 'ì›¹ê°œë°œ'],
#     'ì œëª©': ['ê³¼ì •A', 'ê³¼ì •B', 'ê³¼ì •C', 'ê³¼ì •D', 'ê³¼ì •E', 'ê³¼ì •F', 'ê³¼ì •G', 'ê³¼ì •H'],
#     'ë§Œì¡±ë„ì ìˆ˜': [4.5, 4.7, 4.8, 4.6, 4.9, 4.7, 4.3, 4.5],
#     'ì •ì›_ëŒ€ë¹„_ì‹ ì²­ë¥ ': [1.2, 1.5, 1.8, 1.3, 2.0, 1.6, 0.9, 1.4],
#     'ì‹¤ì œí›ˆë ¨ë¹„': [3000000, 3200000, 4500000, 4200000, 3800000, 3500000, 2500000, 3100000],
#     'í›ˆë ¨ê¸°ê°„_ì¼': [90, 100, 120, 110, 95, 90, 80, 95]
# }
# df1_unique = pd.DataFrame(data)

df1_unique = pd.read_csv("í›ˆë ¨ê³¼ì •_ì „ì²´ë°ì´í„°_ver4.csv")
mask = df1_unique['3ì°¨ë¶„ë¥˜'].notna() # ì˜ˆì‹œë¥¼ ìœ„í•œ ë§ˆìŠ¤í¬

# --- 2. ë°ì´í„° ì§‘ê³„ (ì‚¬ìš©ì ì½”ë“œ) ---
agg_df = df1_unique[mask].groupby('3ì°¨ë¶„ë¥˜').agg(
    í›ˆë ¨_ê°œìˆ˜=('ì œëª©', 'count'),
    ë§Œì¡±ë„ì ìˆ˜=('ë§Œì¡±ë„ì ìˆ˜', 'mean'),
    ì •ì›_ëŒ€ë¹„_ì‹ ì²­ë¥ =('ì •ì›_ëŒ€ë¹„_ì‹ ì²­ë¥ ', 'mean'),
    ì‹¤ì œí›ˆë ¨ë¹„=('ì‹¤ì œí›ˆë ¨ë¹„', 'mean'),
    í›ˆë ¨ê¸°ê°„_ì¼=('í›ˆë ¨ê¸°ê°„_ì¼', 'mean')
)

# ì‹¤ì œí›ˆë ¨ë¹„/í›ˆë ¨ê¸°ê°„_ì¼ í‰ê·  ì»¬ëŸ¼ ì¶”ê°€
agg_df['ì¼_í‰ê· _í›ˆë ¨ë¹„'] = agg_df['ì‹¤ì œí›ˆë ¨ë¹„'] / agg_df['í›ˆë ¨ê¸°ê°„_ì¼']


# --- 3. Streamlit ì•± êµ¬ì„± ---

st.set_page_config(layout="wide") # ë„“ì€ ë ˆì´ì•„ì›ƒ ì‚¬ìš©

st.title('ğŸ“š 3ì°¨ ë¶„ë¥˜ë³„ í›ˆë ¨ ê³¼ì • ë¶„ì„')
st.info('ì´ ì•±ì€ 3ì°¨ ë¶„ë¥˜ì— ë”°ë¥¸ í›ˆë ¨ ê³¼ì •ì˜ ê°œìˆ˜ì™€ ì£¼ìš” ì§€í‘œë¥¼ ì‹œê°í™”í•©ë‹ˆë‹¤.')


# --- 4. ë©”ì¸ ë§‰ëŒ€ê·¸ë˜í”„ ì‹œê°í™” ---
st.header('ë¶„ë¥˜ë³„ í›ˆë ¨ ê°œìˆ˜')

# Plotly ì°¨íŠ¸ ìƒì„± (hover_dataëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ì—¬ ë§ˆìš°ìŠ¤ì˜¤ë²„ ê¸°ëŠ¥ë„ ì œê³µ)
fig = px.bar(
    agg_df,
    x=agg_df.index,
    y='í›ˆë ¨_ê°œìˆ˜',
    hover_data=['ë§Œì¡±ë„ì ìˆ˜', 'ì •ì›_ëŒ€ë¹„_ì‹ ì²­ë¥ ', 'ì¼_í‰ê· _í›ˆë ¨ë¹„'],
    labels={'x': '3ì°¨ ë¶„ë¥˜', 'í›ˆë ¨_ê°œìˆ˜': 'í›ˆë ¨ ê°œìˆ˜'},
    title='3ì°¨ ë¶„ë¥˜ë³„ í›ˆë ¨ ê³¼ì • ìˆ˜'
)
fig.update_xaxes(tickangle=45)
fig.update_layout(title_x=0.5) # ì œëª© ì¤‘ì•™ ì •ë ¬

# Streamlitì— ì°¨íŠ¸ í‘œì‹œ
st.plotly_chart(fig, use_container_width=True)


st.divider() # ì‹œê°ì  êµ¬ë¶„ì„ ìœ„í•œ ë¼ì¸


# --- 5. Hover ë°ì´í„°ë¥¼ ë³„ë„ ì„¹ì…˜ìœ¼ë¡œ ì‹œê°í™” ---
st.header('ë¶„ë¥˜ë³„ ìƒì„¸ ì§€í‘œ ë¹„êµ')
st.markdown('ì•„ë˜ ë“œë¡­ë‹¤ìš´ì—ì„œ íŠ¹ì • `3ì°¨ ë¶„ë¥˜`ë¥¼ ì„ íƒí•˜ì—¬ ìƒì„¸ í‰ê· ê°’ì„ í™•ì¸í•˜ì„¸ìš”.')

# Selectboxë¡œ ì‚¬ìš©ìì—ê²Œ 3ì°¨ ë¶„ë¥˜ ì„ íƒ ì˜µì…˜ ì œê³µ
selected_category = st.selectbox(
    'ë¶„ì„í•  3ì°¨ ë¶„ë¥˜ë¥¼ ì„ íƒí•˜ì„¸ìš”:',
    options=agg_df.index
)

# ì„ íƒëœ ë¶„ë¥˜ì˜ ë°ì´í„° ì¶”ì¶œ
selected_data = agg_df.loc[selected_category]

# st.columnsë¥¼ ì‚¬ìš©í•˜ì—¬ ê¹”ë”í•˜ê²Œ 3ê°œì˜ ë©”íŠ¸ë¦­ìœ¼ë¡œ í‘œì‹œ
col1, col2, col3 = st.columns(3)

with col1:
    st.metric(
        label=f"â­ í‰ê·  ë§Œì¡±ë„ ì ìˆ˜",
        value=f"{selected_data['ë§Œì¡±ë„ì ìˆ˜']:.2f} ì "
    )

with col2:
    st.metric(
        label=f"ğŸ“ˆ í‰ê·  ì‹ ì²­ë¥ ",
        value=f"{selected_data['ì •ì›_ëŒ€ë¹„_ì‹ ì²­ë¥ '] :.2f} %"
    )
print(selected_data['ì¼_í‰ê· _í›ˆë ¨ë¹„'])

with col3:
    st.metric(
        label=f"ğŸ’° ì¼ í‰ê·  í›ˆë ¨ë¹„",
        value=f"{selected_data['ì¼_í‰ê· _í›ˆë ¨ë¹„']:,.0f} ì›"
    )

# ì„ íƒëœ ë°ì´í„°ì˜ ì „ì²´ ì •ë³´ë„ í…Œì´ë¸”ë¡œ í‘œì‹œ
st.subheader(f"'{selected_category}' ë¶„ë¥˜ì˜ ì „ì²´ ë°ì´í„°")
st.dataframe(selected_data.to_frame().T.style.format({
    'ë§Œì¡±ë„ì ìˆ˜': '{:.2f}',
    'ì •ì›_ëŒ€ë¹„_ì‹ ì²­ë¥ ': '{:.2%}',
    'ì‹¤ì œí›ˆë ¨ë¹„': '{:,.0f} ì›',
    'í›ˆë ¨ê¸°ê°„_ì¼': '{:.0f} ì¼',
    'ì¼_í‰ê· _í›ˆë ¨ë¹„': '{:,.0f} ì›'
}))
'''
import streamlit as st
import pandas as pd
import numpy as np
import plotly.express as px
import warnings

warnings.filterwarnings('ignore')

# --- 1. ìƒ˜í”Œ ë°ì´í„° ìƒì„± ---
# ì‹¤ì œ ë°ì´í„°í”„ë ˆì„ 'df1_unique'ê°€ ìˆë‹¤ë©´ ì´ ë¶€ë¶„ì€ ì‚­ì œí•˜ê³  ì‹¤ì œ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.
data = {
    '3ì°¨ë¶„ë¥˜': ['ì›¹ê°œë°œ', 'ì›¹ê°œë°œ', 'ë°ì´í„°ë¶„ì„', 'ë°ì´í„°ë¶„ì„', 'UI/UX', 'UI/UX', 'ì„œë²„ê´€ë¦¬', 'ì›¹ê°œë°œ'],
    'ì œëª©': ['ê³¼ì •A', 'ê³¼ì •B', 'ê³¼ì •C', 'ê³¼ì •D', 'ê³¼ì •E', 'ê³¼ì •F', 'ê³¼ì •G', 'ê³¼ì •H'],
    'ë§Œì¡±ë„ì ìˆ˜': [4.5, 4.7, 4.8, 4.6, 4.9, 4.7, 4.3, 4.5],
    'ì •ì›_ëŒ€ë¹„_ì‹ ì²­ë¥ ': [1.2, 1.5, 1.8, 1.3, 2.0, 1.6, 0.9, 1.4],
    'ì‹¤ì œí›ˆë ¨ë¹„': [3000000, 3200000, 4500000, 4200000, 3800000, 3500000, 2500000, 3100000],
    'í›ˆë ¨ê¸°ê°„_ì¼': [90, 100, 120, 110, 95, 90, 80, 95]
}
df1_unique = pd.DataFrame(data)
mask = df1_unique['3ì°¨ë¶„ë¥˜'].notna()

# --- 2. ë°ì´í„° ì§‘ê³„ ---
agg_df = df1_unique[mask].groupby('3ì°¨ë¶„ë¥˜').agg(
    í›ˆë ¨_ê°œìˆ˜=('ì œëª©', 'count'),
    ë§Œì¡±ë„ì ìˆ˜=('ë§Œì¡±ë„ì ìˆ˜', 'mean'),
    ì •ì›_ëŒ€ë¹„_ì‹ ì²­ë¥ =('ì •ì›_ëŒ€ë¹„_ì‹ ì²­ë¥ ', 'mean'),
    ì‹¤ì œí›ˆë ¨ë¹„=('ì‹¤ì œí›ˆë ¨ë¹„', 'mean'),
    í›ˆë ¨ê¸°ê°„_ì¼=('í›ˆë ¨ê¸°ê°„_ì¼', 'mean')
).sort_values(by='í›ˆë ¨_ê°œìˆ˜', ascending=False) # í›ˆë ¨ ê°œìˆ˜ ìˆœìœ¼ë¡œ ì •ë ¬

agg_df['ì¼_í‰ê· _í›ˆë ¨ë¹„'] = agg_df['ì‹¤ì œí›ˆë ¨ë¹„'] / agg_df['í›ˆë ¨ê¸°ê°„_ì¼']


# --- 3. Streamlit ì•± êµ¬ì„± ---
st.set_page_config(layout="wide")
st.title('ğŸ“š 3ì°¨ ë¶„ë¥˜ë³„ í›ˆë ¨ ê³¼ì • ë¶„ì„')

# --- 4. ë©”ì¸ ë§‰ëŒ€ê·¸ë˜í”„ (í›ˆë ¨ ê°œìˆ˜ ê¸°ì¤€) ---
st.header('ë¶„ë¥˜ë³„ í›ˆë ¨ ê°œìˆ˜')
fig_main = px.bar(
    agg_df,
    x=agg_df.index,
    y='í›ˆë ¨_ê°œìˆ˜',
    title='3ì°¨ ë¶„ë¥˜ë³„ í›ˆë ¨ ê³¼ì • ìˆ˜'
)
st.plotly_chart(fig_main, use_container_width=True)

st.divider()

# --- 5. ëª¨ë“  Hover ë°ì´í„°ë¥¼ ê·¸ë˜í”„ë¡œ í•œ ë²ˆì— ì‹œê°í™” ---
st.header('ì£¼ìš” ì§€í‘œ ì „ì²´ ë¹„êµ')
st.markdown('ê° ì£¼ìš” ì§€í‘œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ëª¨ë“  ë¶„ë¥˜ë¥¼ í•œëˆˆì— ë¹„êµí•©ë‹ˆë‹¤.')

# 3ê°œì˜ ì»¬ëŸ¼ì„ ë§Œë“¤ì–´ ê° ê·¸ë˜í”„ë¥¼ ë‚˜ë€íˆ ë°°ì¹˜
g_col1, g_col2, g_col3 = st.columns(3)

with g_col1:
    # ë§Œì¡±ë„ ì ìˆ˜ ê·¸ë˜í”„ (ë†’ì€ ìˆœ)
    fig1 = px.bar(agg_df.sort_values('ë§Œì¡±ë„ì ìˆ˜', ascending=False),
                  x='ë§Œì¡±ë„ì ìˆ˜', y=agg_df.index, orientation='h',
                  title='â­ í‰ê·  ë§Œì¡±ë„ ì ìˆ˜', labels={'y': '3ì°¨ ë¶„ë¥˜'})
    st.plotly_chart(fig1, use_container_width=True)

with g_col2:
    # í‰ê·  ì‹ ì²­ë¥  ê·¸ë˜í”„ (ë†’ì€ ìˆœ)
    fig2 = px.bar(agg_df.sort_values('ì •ì›_ëŒ€ë¹„_ì‹ ì²­ë¥ ', ascending=False),
                  x='ì •ì›_ëŒ€ë¹„_ì‹ ì²­ë¥ ', y=agg_df.index, orientation='h',
                  title='ğŸ“ˆ í‰ê·  ì‹ ì²­ë¥ ', labels={'y': '3ì°¨ ë¶„ë¥˜'})
    fig2.update_xaxes(tickformat=".0%") # xì¶• ì„œì‹ì„ %ë¡œ ë³€ê²½
    st.plotly_chart(fig2, use_container_width=True)

with g_col3:
    # ì¼ í‰ê·  í›ˆë ¨ë¹„ ê·¸ë˜í”„ (ë†’ì€ ìˆœ)
    fig3 = px.bar(agg_df.sort_values('ì¼_í‰ê· _í›ˆë ¨ë¹„', ascending=False),
                  x='ì¼_í‰ê· _í›ˆë ¨ë¹„', y=agg_df.index, orientation='h',
                  title='ğŸ’° ì¼ í‰ê·  í›ˆë ¨ë¹„', labels={'y': '3ì°¨ ë¶„ë¥˜'})
    st.plotly_chart(fig3, use_container_width=True)

st.divider()

# --- 6. ë¶„ë¥˜ë³„ ìƒì„¸ ì§€í‘œ í™•ì¸ (í›ˆë ¨ ê°œìˆ˜ í¬í•¨) ---
st.header('ë¶„ë¥˜ë³„ ìƒì„¸ ì§€í‘œ í™•ì¸')

selected_category = st.selectbox(
    'ë¶„ì„í•  3ì°¨ ë¶„ë¥˜ë¥¼ ì„ íƒí•˜ì„¸ìš”:',
    options=agg_df.index
)

selected_data = agg_df.loc[selected_category]

# 4ê°œì˜ ì»¬ëŸ¼ì„ ë§Œë“¤ì–´ ë©”íŠ¸ë¦­ í‘œì‹œ (í›ˆë ¨ ê°œìˆ˜ ì¶”ê°€)
m_col1, m_col2, m_col3, m_col4 = st.columns(4)

with m_col1:
    st.metric(
        label=f"ğŸ”¢ í›ˆë ¨ ê°œìˆ˜",
        value=f"{selected_data['í›ˆë ¨_ê°œìˆ˜']} ê°œ"
    )

with m_col2:
    st.metric(
        label=f"â­ í‰ê·  ë§Œì¡±ë„ ì ìˆ˜",
        value=f"{selected_data['ë§Œì¡±ë„ì ìˆ˜']:.2f} ì "
    )

with m_col3:
    st.metric(
        label=f"ğŸ“ˆ í‰ê·  ì‹ ì²­ë¥ ",
        value=f"{selected_data['ì •ì›_ëŒ€ë¹„_ì‹ ì²­ë¥ '] * 100:.1f} %"
    )

with m_col4:
    st.metric(
        label=f"ğŸ’° ì¼ í‰ê·  í›ˆë ¨ë¹„",
        value=f"{selected_data['ì¼_í‰ê· _í›ˆë ¨ë¹„']:,.0f} ì›"
    )

# ì „ì²´ ë°ì´í„° í…Œì´ë¸” í‘œì‹œ (í¬ë§·íŒ…ì— 'í›ˆë ¨_ê°œìˆ˜' ì¶”ê°€)
st.subheader(f"'{selected_category}' ë¶„ë¥˜ì˜ ì „ì²´ ë°ì´í„°")
st.dataframe(selected_data.to_frame().T.style.format({
    'í›ˆë ¨_ê°œìˆ˜': '{:d} ê°œ',
    'ë§Œì¡±ë„ì ìˆ˜': '{:.2f}',
    'ì •ì›_ëŒ€ë¹„_ì‹ ì²­ë¥ ': '{:.2%}',
    'ì‹¤ì œí›ˆë ¨ë¹„': '{:,.0f} ì›',
    'í›ˆë ¨ê¸°ê°„_ì¼': '{:.0f} ì¼',
    'ì¼_í‰ê· _í›ˆë ¨ë¹„': '{:,.0f} ì›'
}), use_container_width=True)